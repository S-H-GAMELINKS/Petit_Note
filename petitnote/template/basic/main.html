<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="<?=h($skindir)?>index.css">
<link rel="stylesheet" href="<?=h($skindir)?>icomoon/style.css">

<?php if($set_nsfw && !$nsfwc):?>
	<!-- センシティブコンテンツにブラーをかける -->
<style>img {filter:blur(6px);}</style>
<?php endif;?>

<title><?=h($boardname)?></title>
</head>
<body>

<div class="container" id="top">

<?php if($set_nsfw && !$nsfwc):?>
	<h2>年齢制限付きのコンテンツを表示してもよろしいでしょうか?</h2>
	<form action="./" method="post">
	<input type="hidden" name="mode" value="view_nsfw">
	<input type="hidden" name="view_nsfw" value="on">
	<input type="hidden" name="page" value="<?=h($page)?>">
	<input type="submit" value="はい表示します。">
</form>
<?php endif;?>

<h1 class="title"><a href="./"><?=h($boardname)?></a></h1>
<!-- ナビゲーション -->
	<?php if($aikotoba):?>
<nav class="memu_wrap">
<span>[<a href="./?mode=catalog">カタログ</a>]</span>
<span>[<a href="./?mode=paintcom">未投稿画像</span></a>]</span>
<?php if($userdel || $admindel):?>
	<span>[<a href="./?mode=logout&page=<?=h($page)?>">編集モード終了</a>]</span>
<?php else:?>
	<span>[<a href="./?mode=userdel&page=<?=h($page)?>">編集</a>]</span>
<?php endif;?>
 <a href="#bottom">▽</a>
 <br>
	</nav>
<?php endif;?>

<?php if($aikotoba&&(!$userdel && !$admindel)):?>
<!-- 掲示板の説明文 -->
<?php if(!empty($descriptions)):?>
<div class="description">
<ul>
<?php foreach($descriptions as $description):?>
	<li><?=h($description)?></li>
	<?php endforeach;?>
</ul>
</div>
<?php endif;?>

	<?php if(!$use_diary || $adminpost):?>
<div class="mainform">

<!-- ペイントフォーム -->
<form action="./" method="post" class="paint_form">
<input type="hidden" name="mode" value="paint">
<input type="submit" value="PAINT" class="paint_button">
<span>TOOL:
<select name="app" class="select_applet">
<option value="neo" 
<?php if($appc==='neo'):?>
selected
<?php endif;?>
>PaintBBS NEO</option>
<option value="chi"
<?php if($appc==='chi'):?>
selected
<?php endif;?>
>ChickenPaint</option>
</select>
</span>
<span class="canvas_size_wrap"> 
Size:
<select name="picw" title="幅" class="canvas_select">
	<?php
	//幅 300から、$pmax_w で設定した最大値まで。
		for($i = 300; $i <=$pmax_w ; $i+=50){//50ずつ増える
		if($picwc==$i){//デフォルトサイズ
		echo'<option value="'.$i.'" selected>'.$i.'</option>';
		}
		else{
		echo'<option value="'.$i.'">'.$i.'</option>';
		}
		}
	?>
	</select>
	x
	<select name="pich" title="高さ" class="canvas_select">
	<?php
	//高さ 300から、PMAX_H で設定した最大値まで。
		for($i = 300; $i <=$pmax_h ; $i+=50){//50ずつ増える
		if($picwc==$i){//デフォルトサイズ
		echo'<option value="'.$i.'" selected>'.$i.'</option>';
		}
		else{
		echo'<option value="'.$i.'">'.$i.'</option>';
		}
		}
	?>
	</select>
</span>
<!-- フォーム入力欄 -->
</form>
	<?php if($use_top_form && ($use_upload||$allow_coments_only||$adminpost)):?>	
	<form action="./" method="POST" enctype="multipart/form-data" class="postform">
	<table>
	<tr>
		<td>名前</td>
		<td>:</td>
		<td><input type="text" name="name" value="<?=h($namec)?>" autocomplete="username"></td>

	</tr>
	<tr>
		<td>題名</td>
		<td>:</td>
		<td><input type="text" name="sub"></td>
	</tr>
	<tr>
		<td>URL</td>
		<td>:</td>
		<td><input type="text" name="url" value="<?=h($urlc)?>"></td>
	</tr>
	</table>
<textarea name="com" class="post_com"></textarea><br>
パスワード:<input type="password" name="pwd" value="<?=h($pwdc)?>" autocomplete="current-password">
<input type="hidden" name="mode" value="regist">
<input type="hidden" name="token" value="<?=h($token)?>">
<br>
<?php if($use_upload || $adminpost):?>
<input type="file" name="imgfile" size="35" accept="image/*" class="form_button">
<br>
<?php endif;?>
<input type="submit" value="スレッドを立てる" class="form_button">
</form>
<?php endif;?>
</div>
<?php endif;?>
<?php endif;?>

<?php if(!$aikotoba):?>
この掲示板の合言葉はなんですか?: 
<form action="./" method="post" class="aikotoba">
	<input type="txt" name="aikotoba">
	<input type="hidden" name="mode" value="aikotoba">
	<input type="hidden" name="postpage" value="<?=h($page)?>">
	<input type="submit" value="秘密の答え">
</form><br>
<?php endif;?>
<hr>
<!-- スレッド -->
	<!-- 親のループ -->
<?php if(isset($out)):?>
<?php foreach($out as $ress) : ?>
	<!-- タイトル -->
	<h2 class="article_title"><a href="./?resno=<?= h($ress[0]['no'])?>" target="_blank">[<?= h($ress[0]['no'])?>] <?= h($ress[0]['sub'])?></a></h2>
	<?php $resform=true; ?>
	<?php
	$dispres=$dispres+1;
	$countres=count($ress);
	$skipres=$countres-$dispres;
	if($userdel || $admindel){
		$skipres=0;	//削除モードの時はレスを省略しない
	}
	?>
		<!-- 個別スレッドのループ -->
		<?php foreach($ress as $i => $res) : ?>
			<?php if($skipres && $i===$skipres):?>
			<hr>
			レス<?=h($skipres)?>件省略中。
			<?php endif;?>	

			<?php if($i===0 || $i>$skipres):?>

		<hr>
		<?php if($i!==0):?>
		<div class="res_wrap">	
		<?php endif;?>

		<div class="imginfo_wrap">
			<span class="info_name"><a href="./?mode=catalog&q=<?=h($res['encoded_name'])?>" target="_blak"><?= h($res['name'])?></a></span>
			<?php if($res['verified']):?>
			<span class="icon-checkmark2"></span>
			<?php endif?>
			<?php if($res['url']):?><span>[<a href="<?=h($res['url'])?>" target="_blank" rel="nofollow noopener noreferrer">URL</a>]</span><?php endif;?>
				<?php if($res['userid']):?><span>ID:<?= h($res['userid'])?></span><?php endif;?>
				<span><?=h($res['date'])?></span>		
			<?php if($res['img']):?>
				<span>TOOL:<?=h($res['tool'])?></span>
				<?php if($res['painttime']):?>
				<span>
					描画時間:<?=h($res['painttime'])?>
				</span>
				<?php endif;?>
				<?php if($res['thumbnail']):?>
				<span>
				- サムネイル表示中 -
				</span>
				<?php endif;?>
						
			<?php endif;?>
		<?php if($admindel):?>
			<br>
			HOST:<?=h($res['host'])?>
			<?php endif;?> 
		</div>
			<?php if($res['img']):?>
			<?php if($res['continue']||$res['anime']):?>
			<div class="imginfo_wrap">
			<?php if($res['continue'] && $aikotoba):?>
			<span>☆<a href="?mode=to_continue&id=<?=h($res['time'])?>&no=<?=h($res['no'])?>">続きを描く</a></span>
			<?php endif;?>
			<?php if($res['anime']):?>
					<span>☆<a href="?mode=pchview&imagefile=<?=h($res['img'])?>" target="_blank">動画</a></span>
			<?php endif;?>
			</div>
			<?php endif;?>
			<div class="posted_image">
			
			<?php if($res['thumbnail']):?>
				<a href="src/<?=h($res['img'])?>" target="_bank">
					<img src="thumbnail/<?=h($res['thumbnail'])?>" alt="" width="<?=h($res['w'])?>" height="<?=h($res['h'])?>" loading="lazy">
				</a>
			<?php else:?>
			<img src="src/<?=h($res['img'])?>" alt="" width="<?=h($res['w'])?>" height="<?=h($res['h'])?>" loading="lazy">
			<?php endif;?>
			</div>
			<?php endif;?>
			<div class="comment"><?= com(h($res['com']))?></div>
			<?php if($i>=$max_res||!$ress[0]['check_elapsed_days']){
				$resform=false;//最大レス数を超えている時はレスフォームを閉じる
			}?>
			<?php if($i!==0):?>
			</div><!-- 子レスのwrap	 -->
			<?php endif;?>
		<?php if($aikotoba && ($userdel || $admindel)):?>
			<!-- 編集削除のためのボタン -->
			<form action="./" method="POST" class="aikotoba">
				<input type="hidden" name="mode" value="before_del">
				<input type="hidden" name="edit_mode" value="editmode">
				<input type="hidden" name="resmode" value="false">
				<input type="hidden" name="id" value="<?=h($res['time'])?>">
				<input type="hidden" name="no" value="<?=h($res['no'])?>">
				<input type="hidden" name="postpage" value="<?=h($page)?>">
				<!-- <input type="hidden" name="resno" value="<?=h($page)?>"> -->
				<input type="submit" value="編集">
			</form>
			<form action="./" method="POST" class="aikotoba">
				<input type="hidden" name="mode" value="before_del">
				<input type="hidden" name="edit_mode" value="delmode">
				<input type="hidden" name="resmode" value="false">
				<input type="hidden" name="id" value="<?=h($res['time'])?>">
				<input type="hidden" name="no" value="<?=h($res['no'])?>">
				<input type="hidden" name="postpage" value="<?=h($page)?>">
				<!-- <input type="hidden" name="resno" value="<?=h($page)?>"> -->
				<input type="submit" value="削除">
			</form>
		<?php endif;?>
			
		<?php endif;?>	
		<?php endforeach;?>
	<!-- 返信ボタン -->
	<div class="clear"></div>

	<div class="res_button_wrap">
	<?php if($aikotoba && (!$userdel && !$admindel)):?>
	<?php if($use_sns_button):?>
	<span class="share_button">
		
		
	<a target="_blank" href="https://twitter.com/intent/tweet?text=<?=$res['encoded_no']?>+<?=$res['encoded_sub']?>+-+<?=h($boardname)?>&amp;url=<?=$res['encoded_u']?>"><span class="icon-twitter"></span>tweet</a>
	</span>
	<?php endif; ?>
	<?php endif; ?>

	<?php if($resform):?>
		<form action="./?resno=<?=h($res['no'])?>" method="POST" class="res_button">
		<input type="submit" value="返信"></form>
	<?php else:?>
		<form action="./?resno=<?=h($res['no'])?>" method="POST" class="res_button">
		<input type="submit" value="表示"></form>
	<?php endif;?>
		<div class="pagetop"><a href="#top">△</a></div>
	</div>

	<hr>
<?php endforeach;?>
<?php endif;?>
<?php
//ページング
$start_page=$page-$pagedef*8;
if($page<$pagedef*17){
	$start_page=0;
}
$end_page=$page+($pagedef*8)	;
if($page<$pagedef*17){
	$end_page=$pagedef*17;
}
//prev next 
$next=(($page+$pagedef)<$count_alllog) ? $page+$pagedef : false;//ページ番号がmaxを超える時はnextのリンクを出さない
$prev=((int)$page!==0) ? ($page-$pagedef) : false;//ページ番号が0の時はprevのリンクを出さない
?>
<div class="pagelink">
	<span class="prev">
			<?php if($prev!==false):?>
			<a href="?page=<?=h($prev)?>">≪prev</a>
	<?php endif;?>
	</span>
	| <a href="#top">top</a> |
	<span class="next">
	<?php if($next):?>
	<a href="?page=<?=h($next)?>">next≫</a>
	<?php endif;?>
	</span>
</div>
<?php if($start_page!==0 && $prev!==false):?>
<a href="?page=0">start</a> |
<?php endif;?>

<?php for($i = 0; $i < $count_alllog ; $i+=$pagedef) :?>
<?php if(($i>=$start_page)&&($i<=$end_page)):?>
	<?php if($page==$i):?>
			[<?=h($i/$pagedef)?>]
		<?php else: ?>
			<?php if($i==0):?>
				[<a href="?page=0">0</a>]
			<?php else:?>	
			<?php if($i === $end_page):?>
			<!-- 特定のページに代入される記号 エンド -->
				[<a href="?page=<?=h($i)?>">≫</a>]
				<?php elseif($i === $start_page):?>
				[<a href="?page=<?=h($i)?>">≪</a>]
					<?php else:?>
			[<a href="?page=<?=h($i)?>"><?=h($i/$pagedef)?></a>]
			<?php endif;?>
			<?php endif;?>
		<?php endif;?>
		<?php endif;?>
		<?php endfor ;?>

		<?php if($next):?>
		| <a href="?page=<?=h(ceil(($count_alllog/$pagedef)-1)*$pagedef)?>">end</a>
		<?php endif;?>
	

	<div class="copy">
		<div class="left_wrap">
		[<a href="<?=h($home)?>">HOME</a> / <a href="./?mode=adminin&page=<?=h($page)?>">管理</a>]
	</div>
<div class="righit_wrap">
<a href="https://github.com/satopian/Petit_Note" target="_blank" rel="rel="noopener">Petit Note</a> <span title="<?=h($petit_lot)?>"><?=h($petit_ver)?></span> <span>Web Style by BASIC</span><br>
<span>OekakiApp - </span><span></span><a href="http://github.com/funige/neo/" target="_blank" rel="noopener noreferrer" title="by funige">PaintBBS NEO</a> , <a href="https://github.com/thenickdude/chickenpaint" target="_blank" rel="noopener noreferrer" title="by Nicholas Sherlock">ChickenPaint</a></span>
<br>
<span>UseFunction - <span title="by WonderCatStudio">DynamicPalette</span></span>
<!--http://wondercatstudio.com/-->
</div>
</div>
</div>
<div id="bottom"></div>
<script src="/jquery-3.5.1.min.js"></script>
<script>
//送信ボタンを押した際に送信ボタンを無効化する（連打による多数送信回避）
$(function(){
$('[type="submit"]').click(function(){
$(this).prop('disabled',true);//ボタンを無効化する
$(this).closest('form').submit();//フォームを送信する
});
});
</script>
</body>
</html>
