<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="index.css">
	<title><?=h($boardname)?></title>
</head>
<body>

<div class="container">
	<h1 class="title"><a href="./"><?=h($boardname)?></a></h1>
	<?php if($aikotoba):?>
<nav class="memu_wrap">
		
<span>[<a href="<?=h($home)?>">HOME</a>]</span>

<span>[<a href="./?mode=paintcom">アップロード途中の画像</a>]</span>
<?php if($userdel || $admindel):?>
<span>[<a href="./?mode=logout&page=<?=h($page)?>">編集モード終了</a>]</span>
<?php else:?>
<span>[<a href="./?mode=userdel&page=<?=h($page)?>">編集</a>]</span>
<span>[<a href="./?mode=adminin&page=<?=h($page)?>">管理</a>]</span>

 <?php endif;?>

 <br>
</nav>
<?php endif;?>
<?php if($aikotoba&&(!$userdel && !$admindel)):?>
<?php if(!$use_diary || $adminpost):?>

	<form action="./" method="post">
<input type="hidden" name="mode" value="paint">
<input type="submit" value="PAINT" class="paint_button">
<span class="select_applet bold_gray">TOOL</span>
<select name="app" class="select_applet">
<option value="neo" 
<?php if($appc==='neo'):?>
selected
<?php endif;?>
>PaintBBS NEO</option>
<option value="chi"
<?php if($appc==='chi'):?>
selected
<?php endif;?>
>ChickenPaint</option>
</select>
<span class="canvas_size_wrap"> 
<span class="canvas_size">Size</span>：
<select name="picw" title="幅" class="canvas_select">
	<?php
	//幅 300から、$pmax_w で設定した最大値まで。
		for($i = 300; $i <=$pmax_w ; $i+=50){//50ずつ増える
		if($picwc==$i){//デフォルトサイズ
		echo'<option value="'.$i.'" selected>'.$i.'</option>';
		}
		else{
		echo'<option value="'.$i.'">'.$i.'</option>';
		}
		}
	?>
	</select>
	x
	<select name="pich" title="高さ" class="canvas_select">
	<?php
	//高さ 300から、PMAX_H で設定した最大値まで。
		for($i = 300; $i <=$pmax_h ; $i+=50){//50ずつ増える
		if($picwc==$i){//デフォルトサイズ
		echo'<option value="'.$i.'" selected>'.$i.'</option>';
		}
		else{
		echo'<option value="'.$i.'">'.$i.'</option>';
		}
		}
	?>
	</select>
</span>
</form>


<form action="./" method="POST" enctype="multipart/form-data" class="postform">
題名:<input type="text" name="sub"><br>
名前:<input type="text" name="name" value="<?=h($namec)?>"><br>
<textarea name="com" class="post_com"></textarea><br>
削除キー:<input type="password" name="pwd">
<input type="hidden" name="mode" value="regist">
<input type="hidden" name="token" value="<?=h($token)?>">
<br>
<?php if($use_upload):?>
<input type="file" name="imgfile" size="35" accept="image/*" class="upfile">
<br>
<?php endif;?>
<input type="submit" value="スレッドを立てる">
</form>
<?php endif;?>
<?php endif;?>
<?php if(!$aikotoba):?>
この掲示板の合言葉はなんですか?: 
<form action="./" method="post" class="aikotoba">
	<input type="txt" name="aikotoba">
	<input type="hidden" name="mode" value="aikotoba">
	<input type="hidden" name="postpage" value="<?=h($page)?>">
	<input type="submit" value="秘密の答え">
</form><br>
<?php endif;?>
<hr>
	<!-- 親のループ -->
<?php if(isset($out)):?>
<?php foreach($out as $ress) : ?>
	<!-- タイトル -->
	<h2 class="article_title"><a href="./?resno=<?= h($ress[0]['no'])?>" target="_blank">[<?= h($ress[0]['no'])?>] <?= h($ress[0]['sub'])?></a></h2>
	<?php $resform=true; ?>
	<!-- スレッドのループ -->
	<?php
	$dispres=$dispres+1;
	$countres=count($ress);
	$skipres=$countres-$dispres;
	if($userdel || $admindel){
		$skipres=0;	//削除モードの時はレスを省略しない
	}
	?>
	<?php foreach($ress as $i => $res) : ?>
		<?php if($skipres && $i===$skipres):?>
		<hr class="reshr">
		レス<?=h($skipres)?>件省略中。
		<?php endif;?>	

		<?php if($i===0 || $i>$skipres):?>

	<hr class="reshr">
	<?php if($i!==0):?>
	<div class="res_wrap">	
	<?php endif;?>

	<div class="imginfo_wrap">
			<span>名前:<?= h($res['name'])?></span>
			<span><?=h($res['date'])?></span>		
		<?php if($res['img']):?>
		<span>(<?=h($res['tool'])?>)</span>
		<?php endif;?>
	<?php if($admindel):?>
		<br>
		HOST:<?=h($res['host'])?>
		<?php endif;?> 
	</div>


		<?php if($res['img']):?>
		<?php if($res['continue']||($res['anime'])):?>
		<div class="imginfo_wrap">
		<?php if($res['continue'] && $aikotoba):?>
		<span>☆<a href="?mode=to_continue&id=<?=h($res['time'])?>&no=<?=h($res['no'])?>">続きを描く</a></span>
		<?php endif;?>
		<?php if($res['anime']):?>
				<span>☆<a href="?mode=pchview&imagefile=<?=h($res['img'])?>" target="_blank">動画</a></span>
		<?php endif;?>
		</div>
		<?php endif;?>
			<div class="posted_image">
				
			<img src="src/<?=h($res['img'])?>" alt="" width="<?=h($res['w'])?>" height="<?=h($res['h'])?>" loading="lazy"></div>
			
			<?php endif;?>
			<div class="comment"><?= h($res['com'])?></div>


			<?php if($i>=$max_res){
				$resform=false;//最大レス数を超えている時はレスフォームを閉じる
			}?>
			<?php if($i!==0):?>
			</div><!-- 子レスのwrap	 -->
			<?php endif;?>
			<?php if($aikotoba && ($userdel || $admindel)):?>

	<form action="./" method="POST" class="aikotoba">
	<input type="hidden" name="mode" value="edit">
	<input type="hidden" name="resmode" value="false">
	<input type="hidden" name="id_and_no" value="<?=h($res['time'])?>,<?=h($res['no'])?>">
	<input type="hidden" name="postpage" value="<?=h($page)?>">
	<!-- <input type="hidden" name="resno" value="<?=h($page)?>"> -->
	<input type="submit" value="編集">
	</form>
	<form action="./" method="POST" class="aikotoba">
	<input type="hidden" name="mode" value="before_del">
	<input type="hidden" name="resmode" value="false">
	<input type="hidden" name="id_and_no" value="<?=h($res['time'])?>,<?=h($res['no'])?>">
	<input type="hidden" name="postpage" value="<?=h($page)?>">
	<!-- <input type="hidden" name="resno" value="<?=h($page)?>"> -->
	<input type="submit" value="削除">
	</form>
<?php endif;?>
		
	<?php endif;?>	
	<?php endforeach;?>
<!-- 返信フォーム -->

<div class="clear"></div>
<?php if($resform):?>
<form action="./?resno=<?=h($res['no'])?>" method="POST" class="resform" target="_blank">
<input type="submit" value="返信">
</form>
<?php endif;?>
<!-- レスフォームが閉じていてレス省略表示の時 -->
<?php if(!$resform):?>
			<form action="./?resno=<?=h($res['no'])?>" method="POST" class="resform">
			<input type="submit" value="全件表示">
			</form>

<?php endif;?>

<hr>
<?php endforeach;?>
<?php endif;?>
<?php
$start_page=$page-$pagedef*8;
if($page<$pagedef*17){
	$start_page=0;
}
$end_page=$page+($pagedef*8)	;
if($page<$pagedef*17){
	$end_page=$pagedef*17;
}
?>
<?php for($i = 0; $i < $count_alllog ; $i+=$pagedef) :?>
<?php if(($i>=$start_page)&&($i<=$end_page)):?>
<?php if($page==$i):?>
		 [<?=h($i/$pagedef)?>]
	<?php else: ?>
	<?php if($i==0):?>
		[<a href="?page=0">0</a>]
	<?php else:?>	

	<!-- 特定のページに代入される記号 エンド -->
	<?php if($i === $end_page):?>
		[<a href="?page=<?=h($i)?>">≫</a>]
		<?php elseif($i === $start_page):?>
		[<a href="?page=<?=h($i)?>">≪</a>]
			<?php else:?>
	  [<a href="?page=<?=h($i)?>"><?=h($i/$pagedef)?></a>]
	<?php endif;?>
	<?php endif;?>
	<?php endif;?>
	<?php endif;?>
	<?php endfor ;?>
<?php if($admindel):?>
	<form action="./" method="post" class="admin">
<input type="hidden" name="mode" value="logout">
<input type="hidden" name="postpage" value="<?=h($page)?>">
<input type="submit" value="編集モード終了">
	</form>
<?php else: ?>
	<form action="./" method="post" class="admin">
<input type="password" name="adminpass">
<input type="hidden" name="mode" value="admin_del">
<input type="hidden" name="postpage" value="<?=h($page)?>">
<input type="submit" value="管理者">
</form>
<?php endif; ?>
<div class="copy">
<a href="https://github.com/satopian/Petit_Note" target="_blank" rel="rel="noopener">Petit Note</a>
</div>
</div>
</body>
</html>
